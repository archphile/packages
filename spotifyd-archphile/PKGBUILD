# Maintainer: Mike Andonov <info@archphile.org>
# Contributor: robot <cultofrobots [at] protonmail [dot] com>
# Website: http://archphile.org
# Contributor: Marcel <marcel@volkerts.eu>
# Based on spotifyd from AUR made by the following people:
# Maintainer: Bert Peters <bert@bertptrs.nl>
# Contributor: Varakh <varakh@varakh.de>
# Contributor: Florian Klink <flokli@flokli.de>

_pkgname=spotifyd
pkgname=spotifyd-archphile
pkgver=0.2.24
pkgrel=1
arch=('armv7h' 'aarch64')
license=('GPL3')
depends=('alsa-lib' 'libogg' 'gcc-libs')
makedepends=('cargo' 'dbus')
pkgdesc="A spotify playing daemon"
url="https://github.com/Spotifyd/$pkgbase"
source=("$_pkgname-$pkgver.tar.gz::https://github.com/Spotifyd/$_pkgname/archive/v$pkgver.tar.gz" "config")
sha256sums=('d3763f4647217a8f98ee938b50e141d67a5f3d33e9378894fde2a92c9845ef80'
            'c05cd013216a630132c20401ef2a4aac7351fdb79e20160630597b7128af83ae')

build() {
  cd "$srcdir/spotifyd-$pkgver"
  # Compile all variants. Compilation for later features can reuse
  # previous build artifacts, so little overhead.
  for feature in "${_features[@]}"; do
    cargo build --release --locked --features "alsa_backend"
  done
}

package () {
  # Create a package for a particular feature.
  cargo install --locked --root "$pkgdir/usr" --path "$srcdir/$_pkgname-$pkgver" --features "alsa_backend"
  rm "$pkgdir/usr/.crates.toml"
  install -D -m 644 "$srcdir/$_pkgname-$pkgver/contrib/spotifyd.service" "$pkgdir/usr/lib/systemd/user/spotifyd.service"
  install -Dm644 "${srcdir}/config" "${pkgdir}/etc/xdg/spotifyd"
}

